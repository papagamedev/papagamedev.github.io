{{ define "main" }}

<div class="subcategory-page">
  <h1>{{ .Title }}</h1>
  
  {{ $categoryKey := .Title | lower | urlize }}
  {{ $lang := .Lang }}
  {{ $categoryData := index .Site.Data.categories $categoryKey }}
  
  {{ if $categoryData }}
    {{ $description := "" }}
    {{ if eq $lang "es" }}
      {{ $description = $categoryData.description.es }}
    {{ else }}
      {{ $description = $categoryData.description.en }}
    {{ end }}
    {{ if $description }}
      <div class="subcategory-description">
        <p>{{ $description }}</p>
      </div>
    {{ end }}
  {{ end }}
  
  {{ with .Content }}
    <div class="subcategory-description">
      {{ . }}
    </div>
  {{ end }}
  
  <div class="post-list">
    {{/* For custom category pages, filter all site posts by category */}}
    {{ $pages := slice }}
    {{ if .IsPage }}
      {{/* This is a custom page, extract the category from URL */}}
      {{ $categoryFromURL := "" }}
      {{ if strings.Contains .RelPermalink "/jpacman/" }}
        {{ $categoryFromURL = "jpacman" }}
      {{ else if strings.Contains .RelPermalink "/learnai/" }}
        {{ $categoryFromURL = "learnai" }}
      {{ else if strings.Contains .RelPermalink "/downloads/" }}
        {{ $categoryFromURL = "downloads" }}
      {{ else if strings.Contains .RelPermalink "/blog/" }}
        {{ $categoryFromURL = "blog" }}
      {{ else if strings.Contains .RelPermalink "/interviews/" }}
        {{ $categoryFromURL = "interviews" }}
      {{ else if strings.Contains .RelPermalink "/recommended-games/" }}
        {{ $categoryFromURL = "recommended_games" }}
      {{ end }}
      
      {{ if $categoryFromURL }}
        {{ range where .Site.RegularPages "Params.categories" "intersect" (slice $categoryFromURL) }}
          {{ if eq .Lang $lang }}
            {{ $pages = $pages | append . }}
          {{ end }}
        {{ end }}
      {{ end }}
    {{ else }}
      {{/* This is a taxonomy term page */}}
      {{ $pages = .Pages }}
    {{ end }}
    
    {{ range $pages }}
      {{ partial "post-card.html" . }}
    {{ end }}
  </div>
  
  {{ if eq (len $pages) 0 }}
    <p>{{ if eq .Lang "es" }}No hay entradas disponibles.{{ else }}No posts available.{{ end }}</p>
  {{ end }}
</div>
{{ end }}
